CREATE TABLE members (
 email NVARCHAR(50) PRIMARY KEY NOT NULL,
 password NVARCHAR(50) NOT NULL,
 full_name NVARCHAR(50) NOT NULL
 );


CREATE TABLE tweets (
 email NVARCHAR(50) NOT NULL,
 message NVARCHAR(140) NOT NULL,
 posted_on DATETIME NOT NULL,
 FOREIGN KEY (email) REFERENCES [dbo].[members](email)
 );

//POPULATE MEMBERS TABLE
DECLARE @counter INT = 1;
DECLARE @max INT = 20000;
DECLARE @email NVARCHAR(50);
DECLARE @password NVARCHAR(50);
DECLARE @full_name NVARCHAR(50);

WHILE (@counter <= @max)
BEGIN
    SET @email = CAST(@counter AS NVARCHAR(50)) + '@email.com';
    SET @password = 'password' + CAST(@counter AS NVARCHAR(50));
    SET @full_name = 'Full Name ' + CAST(@counter AS NVARCHAR(50));

    INSERT INTO members (email, password, full_name)
    VALUES (@email, @password, @full_name);

    SET @counter = @counter + 1;
END;


//POPULATE TWEETS TABLE
DECLARE @email NVARCHAR(50)
DECLARE @message NVARCHAR(140)
DECLARE @posted_on DATETIME
DECLARE @rand INT
DECLARE @i INT = 1
DECLARE @j INT
DECLARE @k INT
DECLARE @count INT = (SELECT COUNT(*) FROM members)

WHILE (@i <= @count)
BEGIN
  SET @email = (SELECT email FROM (SELECT email, ROW_NUMBER() OVER (ORDER BY email) AS RowNum FROM members) sub WHERE RowNum = @i)
  SET @rand = (SELECT ROUND((RAND() * 5) + 0, 0))
  SET @j = 1

  WHILE (@j <= @rand)
  BEGIN
    SET @message = (SELECT REPLICATE('A', 140))
    SET @posted_on = (SELECT DATEADD(SECOND, -(RAND() * 1000000), GETDATE()))
    INSERT INTO tweets (email, message, posted_on) VALUES (@email, @message, @posted_on)
    SET @j = @j + 1
  END

  SET @i = @i + 1
END
